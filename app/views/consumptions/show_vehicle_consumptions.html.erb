<br>
<br>

<center><h1>Autorización</h1></center>

<br>
<br>

<div class="container">

<div class="card card-custom">
    <div class="card-body">
        

        <div class="card-body">
            <%=form_for('', url: filtrado_cargas_path, remote: true) do |f|%>      
            <div class="row">
                <div class="col">
                    <label class="col-sm-0 col-form-label" style="font-family: Arial; font-size:15px;">Fecha inicio:</label>
                     <div class="input-group date" id="datetimepicker5" data-target-input="nearest" data-date-format="DD/MM/YYYY">
                       <input type="text" class="form-control datetimepicker-input" data-target="#datetimepicker5" name="start_date" id="start_date">
                       <div class="input-group-append" data-target="#datetimepicker5" data-toggle="datetimepicker">
                           <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                       </div>
                     </div>                 
                 </div>
                 <div class="col">
                   <label class="col-sm-0 col-form-label" style="font-family: Arial; font-size:15px;">Fecha fin:</label>
                    <div class="input-group date" id="datetimepicker6" data-target-input="nearest" data-date-format="DD/MM/YYYY">
                      <input type="text" class="form-control datetimepicker-input" data-target="#datetimepicker6" name="end_date" id="end_date">
                      <div class="input-group-append" data-target="#datetimepicker6" data-toggle="datetimepicker">
                          <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                      </div>
                    </div>            
                </div>
                <div class="col">
                  <label class="col-form-label" style="font-family: Arial; font-size:15px;">CEDIS</label>
                  <%= collection_select('',:catalog_branch_id ,CatalogBranch.listado_cedis, :id, :decripcion, {prompt:"Escribe el nombre de CEDIS"}, {:class => " form-control m-input m-input--air uneditable-input chosen-select"})%>    

              </div>
              <div class="col">
                <label class="col-form-label" style="font-family: Arial; font-size:15px;">Proveedor</label>
                <%= collection_select('',:catalog_vendor_id ,CatalogVendor.listado_proveedor, :id, :razonsocial, {prompt:"Seleccione el proveedor"}, {:class => " form-control m-input m-input--air uneditable-input chosen-select"})%>


              </div>
                <div class="col">
                 <label class="col-sm-0 col-form-label" style="font-family: Arial; font-size:15px;">Estatus:</label>
                 <%= f.select(:estatus,  [['Todos', ''],['Pendiente', '0'],['Por autorizar', '1']], {}, {:class => " form-control m-input m-input--air uneditable-input chosen-select"})%>
                    </div>
                <div class="col">
                  <br><br>
                  <%= submit_tag  "Limpiar", id:"limpiar", class:"btn btn-primary" %>
                <% end %>
              </div>
            </div>   
            <br>
          </div>




        <div class="table-responsive" style="max-width: 100%; overflow: auto; min-height: 500px !important;">            
            <table class="table table-bordered table-sm text-center" >
            <thead style="background-color: #C6EEF9;">
                <th>Cedis</th>
                <th>Poveedor</th>
                <th>Folios</th>
                <th>F. Inicio</th>
                <th>F. Termino</th>
                <th>Estatus</th>
                <th>Semana</th>
                <th>Cargas</th>
                <th>Montos</th>
               
                <th>Acción</th>

            </thead>
            <% ( @encabezado || []).each do |enc| %>
                <tr class="contenedor" data-list="<%=enc.to_json%> ">
                    <td class="cedis"><%=  enc["cedis"] %></td>
                    <td class="catalog_vendor_id"><%=  enc["vendor"] %></td>
                    
                    <td class="folios"><%=  enc["folios"] %></td>
                    <td class="fecha_inicio"><%= enc["fecha_inicio"] %></td>
                    <td class="fecha_fin"><%=  enc["fecha_fin"] %></td>

                    <td class="estatus"><%=  enc["estatus"] %></td>
                    <td class="semana"><%=  enc["semana"] %></td>
                    <td class="cargas"><%=  enc["cargas"] %></td>
                    <td class="montos"><%=  number_to_currency(enc["monto"], precision: 2) %></td>
                    <td>
            
                                <a href='<%=solicitud_pago_path(enc["semana"],enc["catalog_branch_id"],enc["catalog_vendor_id"])%>' class="list-group-item list-group-item-action">
                                 <span class="svg-icon svg-icon-md"> 
                                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px"
                                    viewBox="0 0 24 24" version="1.1">
                                        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                            <rect x="0" y="0" width="24" height="24"></rect>
                                            <path d="M8,17.9148182 L8,5.96685884 C8,5.56391781 8.16211443,5.17792052 8.44982609,4.89581508 L10.965708,2.42895648 C11.5426798,1.86322723 12.4640974,1.85620921 13.0496196,2.41308426 L15.5337377,4.77566479 C15.8314604,5.0588212 16,5.45170806 16,5.86258077 L16,17.9148182 C16,18.7432453 15.3284271,19.4148182 14.5,19.4148182 L9.5,19.4148182 C8.67157288,19.4148182 8,18.7432453 8,17.9148182 Z"
                                                fill="#000000" fill-rule="nonzero" transform="translate(12.000000, 10.707409) rotate(-135.000000) translate(-12.000000, -10.707409) ">
                                            </path>
                                            <rect fill="#000000" opacity="0.3" x="5" y="20" width="15" height="2" rx="1"></rect>
                                        </g>
                                    </svg> 
                                </span>
                            </a>

                    </td>                    
                </tr>
            <%end%>
            </table>
        </div>
    </div>

</div>




</div>


<script>
    $(document).ready(function(){
        
        $('#datetimepicker5').datetimepicker({
            format: 'DD/MM/YYYY',
            locale: 'es'
            });
        
        $('#datetimepicker6').datetimepicker({
            format: 'DD/MM/YYYY',
            locale: 'es',
            useCurrent: false
            });
            
         


        $("#limpiar").on("click",function() {

            $("#datetimepicker5").val(undefined)
            $("#datetimepicker6").val(undefined)
            $("#start_date").val(undefined)
            $("#end_date").val(undefined)
            
            
            $("#catalog_branch_id").val(undefined).trigger("chosen:updated")

            $("#catalog_branch_id").val(undefined).trigger("chosen:updated")

            $("#estatus").val(undefined).trigger("chosen:updated")

            
            $(".contenedor").filter(function() {
                $(this).show(true)
                //$content=$(this)             
                //console.log($(this).find(".fecha_compra").text(),$content.css('display'))
            });
    
        })
            
        $('.searchbox-input').on("keyup", function() {
            var value = $(this).val().toLowerCase();
            $(".contenedor").filter(function() {
              $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });
    
        $("#datetimepicker5").on("change.datetimepicker", function (e) {
            allFiltro()
        });
    
        
        $("#datetimepicker6").on("change.datetimepicker", function (e) {
            console.log("Fecha:", $(this).val() )
            console.log("FEcha", $("#end_date").val() )
            

            allFiltro()
        });
    
    
    
        function setFiltroDate($elemento,$filtro,$comparacion="inicio") {
            var text = $($elemento).val().toLowerCase();
            text=moment( text, "MM/DD/YYYY" ).format('YYYY/MM/DD')
            var dateText=moment( $($elemento).val(), "DD/MM/YYYY" )
            console.log("dateText: ",dateText)
    
            $("."+$filtro).filter(function() {
                textTabla=$(this).text()
                var dateTabla=moment( textTabla, "DD/MM/YYYY" ) 
    
                if( $(this).parent().css('display') != 'none' )
                    if($comparacion=="termino")
                        $(this).parent().toggle(dateTabla<=dateText)
                    else 
                        $(this).parent().toggle(dateTabla>=dateText)
                });            
            
        }
    
    
        
        
        function setFiltroText($elemento,$filtro) {
            var text = $($elemento).val().toLowerCase();
            $("."+$filtro).filter(function() {
                if( $(this).parent().css('display') != 'none' )
                    $(this).parent().toggle($(this).text().toLowerCase().indexOf(text) > -1)
            });            
            
        }
    
    
            
        function allFiltro(){
            $(".contenedor").filter(function() {
                $(this).show(true)
                //$content=$(this)             
                //console.log($(this).find(".fecha_compra").text(),$content.css('display'))
            });
            if($("#start_date").val()!=undefined &&$("#start_date").val()!="")
                  setFiltroDate("#start_date","fecha_inicio")
            
    
            if($("#end_date").val()!=undefined &&$("#end_date").val()!="")
                  setFiltroDate("#end_date","fecha_fin","termino")
            
                        
            if($("#catalog_branch_id").val()>0 && $("#catalog_branch_id").val()!='' && $("#catalog_branch_id").val()!=undefined)
                setFiltroSelect("#catalog_branch_id","cedis")
    
            if($("#catalog_vendor_id").val()>0 && $("#catalog_vendor_id").val()!='' && $("#catalog_vendor_id").val()!=undefined)
                setFiltroSelect("#catalog_vendor_id","catalog_vendor_id")
                
            if($("#estatus").val()>=0 && $("#estatus").val()!='' && $("#estatus").val()!=undefined)
                setFiltroSelect("#estatus","estatus")
                        
       }
    
    
        function setFiltroSelect($elemento,$filtro){
            var text = $($elemento).val().toLowerCase();
            text=$($elemento).find("option:selected").text().toLowerCase()
            $("."+$filtro).filter(function() {
                console.log($(this).parent().css('display'))
                if( $(this).parent().css('display') != 'none' ){
                    console.log("Text:",text,"valor:",$(this).text().toLowerCase())
                    $(this).parent().toggle($(this).text().toLowerCase().indexOf(text) > -1)
                }
            });            
        }
    
        $("#keyword").on("keyup",function() {
            allFiltro()
        })
    
    
    
        
        $("#estatus").on("change",function() {
            console.log($(this).val())
            allFiltro()
        })
    
    
        $("#vehicle_type_id").on("change",function() {
            allFiltro()
        })
    
        $("#catalog_branch_id").on("change",function() {
            allFiltro()
        })
    
        $("#catalog_vendor_id").on("change",function() {
            allFiltro()
        })
    

    
      });
    
    </script>
